import * as should from 'should';
import { UDPLinearizer } from '../linearizer.js';
import { BinPayload } from '../../packets/binPayload.js';

describe('UDPLinearizer', () => {

        const p2726 = '01010100b1b29405b7b29405bdb29405b8b29405beb2940531313131640100000600020105050010050000000c0100005a37f88416044437a2e270855006c7247d5d64aa742e4f53b7643e69908f57db0300000000000000000000000000000001000000da1fba8221b148dd9c613cae176b8986030000003200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031313131640100000600020105050010060000000c01000080ea84bc48214443ac2f9d214173919b7d5d64aa742e4f53b7643e69908f57db01000000000000000000000000000000010000000cc6f2270f154be2b1c1e1badadc41dd030000003200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031313131640100000600020105050010070000000c01000084c3c085b00345cb857d036981445ce87d5d64aa742e4f53b7643e69908f57db040000000000000000000000000000000100000013936167c549448d94579af9c73e8080030000003200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031313131640100000600020105050010080000000c0100002c04c69b0e2a4e3fb7d47cb4e1fee8337d5d64aa742e4f53b7643e69908f57db06000000000000000000000000000000010000001bc98c7b15934bd1af58c32902035faa03000000320000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
        const p2727 = '01010100b1b29405b8b29405bdb29405b9b29405beb2940500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000313131316401000006000201050500100b0000000c010000f52c7d61b1804923b1b6c710682ea14c7d5d64aa742e4f53b7643e69908f57db090000000000000000000000000000000100000069bc4cc35308484ba10f8086c1ba1436030000003200002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031313131640100000600020105050010090000000c010000803ccb3a8af747dc8d07e014f9387e4d7d5d64aa742e4f53b7643e69908f57db070000000000000000000000000000000100000005c265d5284940578eb0b1accd7c86970300000032000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000313131316401000006000201050500100a0000000c0100006d0de30c471643978a9a70b6f4c053647d5d64aa742e4f53b7643e69908f57db0800000000000000000000000000000001000000077a1e96888c42edb08f6825ddcc246f03000000320000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
        const p2728 = '01010100b1b29405b9b29405bdb29405bab29405beb2940500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
        
        it('3 packets is a complete sequence', () => {

                const l = new UDPLinearizer();

                const packet2726 = BinPayload.deserialize(Buffer.from(p2726, 'hex'));
                const packet2727 = BinPayload.deserialize(Buffer.from(p2727, 'hex'));
                const packet2728 = BinPayload.deserialize(Buffer.from(p2728, 'hex'));

                l.push(packet2726);
                l.push(packet2727);
                l.push(packet2728);

                l.isComplete.should.be.true();
        });

        it('1 packet is an incomplete sequence', () => {

                const l = new UDPLinearizer();

                const packet2726 = BinPayload.deserialize(Buffer.from(p2726, 'hex'));

                l.push(packet2726);

                l.isComplete.should.be.false();

        });

        it('quick check', () => {

                const p = '000101012F302DFB2F302DFD2F302DFB2F302DFD2F302DFC313131310000003406000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40100000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40200000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40300000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40400000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40500000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40600000000000000000000000000000006000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40700000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40800000000000000000000000000000002000000313131313400000006000000030a00000000000024000000b8c0c8be533640a2ad88670b21f570d40900000000000000000000000000000002000000313131313800000006000000020a00000000000028000000010000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000020000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000030000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000040000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000050000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000060000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000070000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000080000000000000000000000000000000b01000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000090000000000000000000000000000000801000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000e01ac2441d884e15aa01d5437b4308c60300000001000000b8095b02d06c988c84a30b02108e7a00313131313800000006000000020a00000000000028000000fc637735a1ef40ac95553c296bdd5c120300000001000000b8095b02d06c988c84a30b02108e7a0031313131';
                const l = new UDPLinearizer();
                l.push(BinPayload.deserialize(Buffer.from(p, 'hex')));
                l.isComplete.should.be.false();
        })
});